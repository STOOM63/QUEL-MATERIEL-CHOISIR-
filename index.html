<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>STOOM ‚Äî Assistant mat√©riel (tablette)</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.085);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.52);
      --brand:#3B82F6;     /* bleu STOOM (modifiable) */
      --brand2:#60A5FA;
      --ok:#22C55E;
      --warn:#F59E0B;
      --bad:#EF4444;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r: 22px;
      --tap: 64px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(59,130,246,.35), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(96,165,250,.22), transparent 55%),
        radial-gradient(900px 600px at 50% 100%, rgba(34,197,94,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .wrap{
      max-width: 1080px;
      margin: 0 auto;
      padding: 22px 18px 40px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .logo{
      width:44px; height:44px;
      border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.45), transparent 60%),
        linear-gradient(135deg, rgba(59,130,246,.95), rgba(96,165,250,.65));
      box-shadow: 0 10px 30px rgba(59,130,246,.22);
      border:1px solid rgba(255,255,255,.20);
      flex:0 0 auto;
    }
    .brand h1{
      font-size: 18px;
      line-height:1.15;
      margin:0;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand p{
      margin:2px 0 0;
      font-size: 12.5px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex:0 0 auto;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted);
      font-size: 12.5px;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: var(--ok);
      box-shadow:0 0 0 6px rgba(34,197,94,.12);
    }

    .btn{
      border:none;
      border-radius: 16px;
      min-height: 48px;
      padding: 12px 14px;
      font-weight: 700;
      letter-spacing:.2px;
      color: rgba(255,255,255,.94);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(96,165,250,.75));
      border-color: rgba(255,255,255,.20);
      box-shadow: 0 14px 40px rgba(59,130,246,.18);
    }
    .btn.ghost{
      background: rgba(255,255,255,.06);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items:start;
    }

    .panel{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .panelHead{
      padding: 16px 16px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
    }
    .panelHead .title{
      margin:0;
      font-size: 15px;
      letter-spacing:.2px;
    }
    .panelHead .sub{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
      max-width: 58ch;
    }

    /* Progress */
    .progressWrap{
      padding: 0 16px 14px;
    }
    .progress{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(59,130,246,.95), rgba(96,165,250,.65));
      border-right:1px solid rgba(255,255,255,.24);
      transition: width .25s ease;
    }
    .stepsRow{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted2);
      font-size: 12px;
    }
    .stepChip{
      padding: 7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    .stepChip.on{
      color: rgba(255,255,255,.90);
      border-color: rgba(59,130,246,.45);
      background: rgba(59,130,246,.12);
    }

    /* Questions */
    .content{
      padding: 14px 16px 16px;
    }

    .q{
      margin: 0 0 10px;
      font-size: 14px;
      color: rgba(255,255,255,.90);
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .q small{
      font-weight:600;
      color: var(--muted2);
    }

    .options{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }

    .opt{
      min-height: var(--tap);
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      gap:12px;
      transition: background .15s ease, border-color .15s ease, transform .08s ease;
      user-select:none;
    }
    .opt:active{ transform: translateY(1px) scale(.995); }
    .opt .icon{
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      display:grid;
      place-items:center;
      font-weight:900;
      color: rgba(255,255,255,.86);
      flex:0 0 auto;
    }
    .opt .txt{ min-width:0; }
    .opt .txt .t{
      font-weight:800;
      letter-spacing:.2px;
      font-size: 14px;
      margin:0 0 4px;
    }
    .opt .txt .d{
      margin:0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.25;
    }

    .opt.on{
      background: rgba(59,130,246,.12);
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 10px 26px rgba(59,130,246,.12);
    }
    .opt.on .icon{
      background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(96,165,250,.65));
      border-color: rgba(255,255,255,.20);
    }

    .navRow{
      margin-top: 14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }

    /* Side summary */
    .side{
      padding: 14px;
    }
    .summaryTitle{
      margin: 0 0 10px;
      font-size: 14px;
      color: rgba(255,255,255,.88);
    }
    .mini{
      display:grid;
      gap:10px;
    }
    .miniCard{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 12px 12px;
    }
    .miniCard .k{
      color: var(--muted2);
      font-size: 12px;
      margin:0 0 6px;
    }
    .miniCard .v{
      margin:0;
      font-weight:800;
      font-size: 13.5px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .hint{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }

    /* Result */
    .result{
      margin-top: 14px;
      padding: 14px 14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
    }
    .badges{ display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
    .b{
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight:800;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
    }
    .b.ok{ background: rgba(34,197,94,.10); border-color: rgba(34,197,94,.35); }
    .b.warn{ background: rgba(245,158,11,.12); border-color: rgba(245,158,11,.40); }
    .b.info{ background: rgba(59,130,246,.12); border-color: rgba(59,130,246,.40); }

    .kpis{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:10px;
      margin-top: 10px;
    }
    .kpi{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding: 12px;
    }
    .kpi .k{ margin:0 0 6px; color: var(--muted2); font-size: 12px; }
    .kpi .v{ margin:0; font-weight:900; font-size: 14px; }
    .kpi .s{ margin:6px 0 0; color: var(--muted); font-size: 12px; line-height:1.25; }

    .list{
      margin: 12px 0 0;
      padding: 0;
      list-style:none;
      display:grid;
      gap:8px;
    }
    .li{
      display:flex; gap:10px; align-items:flex-start;
      padding: 10px 10px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .li .ic{
      width:26px;height:26px;border-radius:10px;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      flex:0 0 auto;
      font-weight:900;
      color: rgba(255,255,255,.86);
    }
    .li .tx{
      min-width:0;
      color: rgba(255,255,255,.86);
      font-size: 12.8px;
      line-height:1.25;
    }

    .tools{
      display:flex;
      gap:10px;
      margin-top: 12px;
    }
    .tools .btn{ flex:1; }

    /* Tablet friendliness */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .kpis{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>STOOM ‚Äî Assistant mat√©riel</h1>
          <p>Parcours vendeur ‚Ä¢ tablette tactile ‚Ä¢ recommandations coh√©rentes sevrage</p>
        </div>
      </div>

      <div class="actions">
        <div class="pill"><span class="dot"></span>Pr√™t en boutique</div>
        <button class="btn ghost" id="resetBtn" type="button">R√©initialiser</button>
      </div>
    </div>

    <div class="grid">
      <!-- Main panel -->
      <section class="panel" aria-label="Parcours">
        <header class="panelHead">
          <div>
            <h2 class="title" id="panelTitle">√âtape 1 ‚Äî Profil fumeur</h2>
            <p class="sub" id="panelSub">
              On commence simple : consommation + type de sensation. L‚Äôobjectif : confort et z√©ro frustration.
            </p>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:900;font-size:12px;color:var(--muted2);">Progression</div>
            <div style="font-weight:900;font-size:16px;" id="pct">0%</div>
          </div>
        </header>

        <div class="progressWrap">
          <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="bar" id="bar"></div>
          </div>
          <div class="stepsRow" id="chips">
            <span class="stepChip on">1 Profil</span>
            <span class="stepChip">2 Habitudes</span>
            <span class="stepChip">3 Priorit√©s</span>
            <span class="stepChip">R√©sultat</span>
          </div>
        </div>

        <div class="content" id="content"></div>
      </section>

      <!-- Side panel -->
      <aside class="panel" aria-label="R√©sum√©">
        <div class="side">
          <h3 class="summaryTitle">R√©sum√© client</h3>

          <div class="mini">
            <div class="miniCard">
              <p class="k">Consommation</p>
              <p class="v" id="sCigs">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Sensation recherch√©e</p>
              <p class="v" id="sFeel">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Niveau</p>
              <p class="v" id="sLevel">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Contexte</p>
              <p class="v" id="sContext">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Priorit√©</p>
              <p class="v" id="sPriority">‚Äî</p>
            </div>
          </div>

          <p class="hint">
            üí° Astuce vendeur : si le client h√©site, privil√©gier le confort (tirage serr√© + dosage adapt√©) avant de parler ‚Äúgrosse vapeur‚Äù.
          </p>

          <div class="result" id="resultBox" style="display:none;">
            <div class="badges" id="badges"></div>

            <div class="kpis">
              <div class="kpi">
                <p class="k">Tirage conseill√©</p>
                <p class="v" id="rDraw">‚Äî</p>
                <p class="s" id="rDrawNote"></p>
              </div>
              <div class="kpi">
                <p class="k">Puissance & r√©sistance</p>
                <p class="v" id="rPower">‚Äî</p>
                <p class="s" id="rPowerNote"></p>
              </div>
              <div class="kpi">
                <p class="k">Nicotine (rep√®re)</p>
                <p class="v" id="rNico">‚Äî</p>
                <p class="s" id="rNicoNote"></p>
              </div>
            </div>

            <ul class="list" id="avoid"></ul>

            <div class="tools">
              <button class="btn ghost" id="copyBtn" type="button">Copier le r√©sum√©</button>
              <button class="btn primary" id="newBtn" type="button">Nouveau client</button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
  // --------- State ----------
  const state = {
    step: 1,
    cigs: null,     // low, mid, high, veryhigh
    feel: null,     // cig, balanced, vapeur
    level: null,    // beginner, intermediate, advanced
    context: null,  // quick, home, car, mixed
    priority: null  // simple, autonomie, discret, vapeur
  };

  // Labels
  const L = {
    cigs: {
      low: "‚Äì 10 cig/j",
      mid: "10‚Äì15 cig/j",
      high: "15‚Äì20 cig/j",
      veryhigh: "20+ cig/j"
    },
    feel: {
      cig: "Proche cigarette (hit / tirage serr√©)",
      balanced: "√âquilibr√© (confort + polyvalent)",
      vapeur: "Plus de vapeur (sans se cramer)"
    },
    level: {
      beginner: "D√©butant",
      intermediate: "D√©j√† vapot√©",
      advanced: "Confirm√©"
    },
    context: {
      quick: "Pauses rapides (travail)",
      home: "Plut√¥t maison",
      car: "Beaucoup voiture",
      mixed: "Un peu partout"
    },
    priority: {
      simple: "Simple & fiable",
      autonomie: "Autonomie",
      discret: "Discret",
      vapeur: "Vapeur"
    }
  };

  // --------- UI helpers ----------
  const $ = (sel) => document.querySelector(sel);

  function setSummary(){
    $("#sCigs").textContent = state.cigs ? L.cigs[state.cigs] : "‚Äî";
    $("#sFeel").textContent = state.feel ? L.feel[state.feel] : "‚Äî";
    $("#sLevel").textContent = state.level ? L.level[state.level] : "‚Äî";
    $("#sContext").textContent = state.context ? L.context[state.context] : "‚Äî";
    $("#sPriority").textContent = state.priority ? L.priority[state.priority] : "‚Äî";
  }

  function setProgress(){
    const totalSteps = 4;
    const pct = Math.round(((state.step-1) / (totalSteps-1)) * 100);
    $("#pct").textContent = pct + "%";
    $("#bar").style.width = pct + "%";
    $(".progress").setAttribute("aria-valuenow", String(pct));

    const chips = [...$("#chips").children];
    chips.forEach((c, i) => c.classList.toggle("on", i <= state.step-1));
  }

  function cardOption({key, value, icon, title, desc}){
    const on = state[key] === value ? " on" : "";
    return `
      <div class="opt${on}" role="button" tabindex="0"
           data-key="${key}" data-value="${value}">
        <div class="icon">${icon}</div>
        <div class="txt">
          <p class="t">${title}</p>
          <p class="d">${desc}</p>
        </div>
      </div>
    `;
  }

  function mount(html){
    $("#content").innerHTML = html;
    // click + enter/space
    $("#content").querySelectorAll(".opt").forEach(el => {
      el.addEventListener("click", () => pick(el.dataset.key, el.dataset.value));
      el.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          pick(el.dataset.key, el.dataset.value);
        }
      });
    });
  }

  function pick(key, value){
    state[key] = value;
    render(); // keep step, just update selection
    // auto-advance when a step is complete (smooth, vendeur-friendly)
    autoAdvance();
  }

  function stepComplete(n){
    if(n === 1) return !!(state.cigs && state.feel);
    if(n === 2) return !!(state.level && state.context);
    if(n === 3) return !!(state.priority);
    return true;
  }

  function autoAdvance(){
    if(state.step === 1 && stepComplete(1)){ state.step = 2; render(); return; }
    if(state.step === 2 && stepComplete(2)){ state.step = 3; render(); return; }
    if(state.step === 3 && stepComplete(3)){ state.step = 4; render(); return; }
  }

  function navButtons(){
    const backDisabled = state.step === 1;
    const nextDisabled = (state.step === 1 && !stepComplete(1)) ||
                         (state.step === 2 && !stepComplete(2)) ||
                         (state.step === 3 && !stepComplete(3));
    const nextLabel = state.step < 4 ? "Continuer" : "Revoir";
    return `
      <div class="navRow">
        <button class="btn ghost" type="button" ${backDisabled ? "disabled" : ""} id="backBtn">Retour</button>
        <button class="btn primary" type="button" ${nextDisabled ? "disabled" : ""} id="nextBtn">${nextLabel}</button>
      </div>
    `;
  }

  function wireNav(){
    const back = $("#backBtn");
    const next = $("#nextBtn");
    if(back) back.onclick = () => { state.step = Math.max(1, state.step-1); render(); };
    if(next) next.onclick = () => {
      if(state.step < 4){
        state.step += 1;
        render();
      }else{
        // "Revoir" -> back to step 1
        state.step = 1;
        render();
      }
    };
  }

  // --------- Recommendation engine (STOOM rules) ----------
  function recommend(){
    // Base recommendation
    let draw = "Serr√© (MTL)";
    let drawNote = "Sensation proche de la cigarette, tr√®s efficace en sevrage.";
    let power = "Faible √† mod√©r√©e ‚Ä¢ 10‚Äì18W ‚Ä¢ r√©sistances 0.8‚Äì1.4Œ©";
    let powerNote = "Confort, hit ma√Ætris√©, peu d‚Äôirritation.";
    let nico = "3‚Äì6 mg/ml";
    let nicoNote = "Ajuster selon envies / fr√©quence. Objectif : z√©ro frustration.";

    const badges = [];
    const avoid = [];

    // Consumption influence
    if(state.cigs === "low"){
      nico = "3‚Äì6 mg/ml";
      badges.push({t:"Profil l√©ger", c:"info"});
    }
    if(state.cigs === "mid"){
      nico = "6‚Äì12 mg/ml";
      badges.push({t:"Profil mod√©r√©", c:"info"});
      avoid.push("Partir trop bas en nicotine (risque d‚Äôenvies persistantes).");
    }
    if(state.cigs === "high"){
      nico = "10‚Äì12 mg/ml (ou 10 mg sels selon confort)";
      badges.push({t:"Profil soutenu", c:"warn"});
      avoid.push("Mat√©riel trop puissant avec nicotine √©lev√©e (hit trop fort / irritation).");
    }
    if(state.cigs === "veryhigh"){
      nico = "12‚Äì20 mg/ml (sels possibles)";
      badges.push({t:"Profil intense", c:"warn"});
      draw = "Serr√© (MTL) ou tr√®s restrictif";
      drawNote = "Priorit√© au hit + sati√©t√© nicotinique pour √©viter la rechute.";
      power = "Faible ‚Ä¢ 8‚Äì15W ‚Ä¢ r√©sistances 1.0‚Äì1.4Œ©";
      powerNote = "Plus stable et confortable avec des dosages √©lev√©s.";
      avoid.push("Inhalation directe (DL) au d√©marrage.");
      avoid.push("Baisser trop vite la nicotine (frustration ‚Üí rechute).");
    }

    // Desired sensation influence
    if(state.feel === "cig"){
      draw = "Serr√© (MTL)";
      drawNote = "Tirage serr√© + hit : rep√®re proche cigarette.";
      badges.push({t:"Priorit√© sevrage", c:"ok"});
    }
    if(state.feel === "balanced"){
      draw = "MTL confortable / RDL l√©ger";
      drawNote = "Polyvalent : bon compromis sensation / vapeur.";
      power = "Mod√©r√©e ‚Ä¢ 12‚Äì22W ‚Ä¢ r√©sistances 0.6‚Äì1.0Œ©";
      powerNote = "Convient √† beaucoup de profils, surtout d√©j√† vapoteurs.";
      badges.push({t:"Polyvalent", c:"info"});
    }
    if(state.feel === "vapeur"){
      draw = "Semi-a√©rien (RDL)";
      drawNote = "Plus de vapeur, mais sans sacrifier le confort.";
      power = "Mod√©r√©e ‚Ä¢ 18‚Äì30W ‚Ä¢ r√©sistances 0.4‚Äì0.8Œ©";
      powerNote = "Dosage nicotine souvent plus bas en RDL.";
      badges.push({t:"Vapeur ma√Ætris√©e", c:"info"});
      avoid.push("Rester haut en nicotine avec un tirage trop a√©rien.");
    }

    // Experience influence
    if(state.level === "beginner"){
      badges.push({t:"D√©butant", c:"ok"});
      avoid.push("Trop de r√©glages / mat√©riel complexe au d√©part.");
      // keep stable
    }
    if(state.level === "intermediate"){
      badges.push({t:"D√©j√† vapot√©", c:"info"});
    }
    if(state.level === "advanced"){
      badges.push({t:"Confirm√©", c:"info"});
      // allow more power if feel vapeur
      if(state.feel === "vapeur"){
        power = "Mod√©r√©e √† soutenue ‚Ä¢ 25‚Äì45W ‚Ä¢ r√©sistances 0.2‚Äì0.6Œ©";
        powerNote = "Uniquement si le dosage nicotine est adapt√© et le client sait g√©rer.";
      }
    }

    // Context influence
    if(state.context === "quick"){
      badges.push({t:"Pauses rapides", c:"info"});
      avoid.push("Autonomie trop faible (risque de panne en journ√©e).");
    }
    if(state.context === "car"){
      badges.push({t:"Voiture", c:"info"});
      avoid.push("Airflow trop ouvert (projection / bruit).");
    }

    // Priority influence
    if(state.priority === "simple"){
      badges.push({t:"Simple & fiable", c:"ok"});
      drawNote += " Id√©al en kit/pod simple.";
    }
    if(state.priority === "autonomie"){
      badges.push({t:"Autonomie", c:"info"});
      avoid.push("Petite batterie si grosse conso ‚Üí frustration.");
    }
    if(state.priority === "discret"){
      badges.push({t:"Discret", c:"info"});
      avoid.push("Gros setup si le client veut du pocket-friendly.");
    }
    if(state.priority === "vapeur"){
      badges.push({t:"Vapeur", c:"info"});
      // already handled by feel, but keep reminder
      avoid.push("Chercher la vapeur avant la stabilit√© (risque d‚Äôabandon).");
    }

    // Clean avoid duplicates
    const uniqAvoid = [...new Set(avoid)];
    if(uniqAvoid.length === 0){
      uniqAvoid.push("Changer trop de param√®tres en m√™me temps : y aller progressivement.");
    }

    return { draw, drawNote, power, powerNote, nico, nicoNote, badges, uniqAvoid };
  }

  function showResult(){
    const rec = recommend();
    $("#resultBox").style.display = "block";

    // badges
    const b = rec.badges.slice(0,6).map(x => `<span class="b ${x.c}">${x.t}</span>`).join("");
    $("#badges").innerHTML = b || `<span class="b info">Recommandation</span>`;

    $("#rDraw").textContent = rec.draw;
    $("#rDrawNote").textContent = rec.drawNote;

    $("#rPower").textContent = rec.power;
    $("#rPowerNote").textContent = rec.powerNote;

    $("#rNico").textContent = rec.nico;
    $("#rNicoNote").textContent = rec.nicoNote;

    $("#avoid").innerHTML = rec.uniqAvoid
      .slice(0,5)
      .map(t => `<li class="li"><div class="ic">!</div><div class="tx">${t}</div></li>`)
      .join("");

    // Copy summary
    $("#copyBtn").onclick = async () => {
      const txt =
`STOOM ‚Äî R√©sum√© orientation mat√©riel
- Consommation : ${state.cigs ? L.cigs[state.cigs] : "‚Äî"}
- Sensation : ${state.feel ? L.feel[state.feel] : "‚Äî"}
- Niveau : ${state.level ? L.level[state.level] : "‚Äî"}
- Contexte : ${state.context ? L.context[state.context] : "‚Äî"}
- Priorit√© : ${state.priority ? L.priority[state.priority] : "‚Äî"}

Recommandation :
- Tirage : ${rec.draw}
- Puissance : ${rec.power}
- Nicotine (rep√®re) : ${rec.nico}

√Ä √©viter :
- ${rec.uniqAvoid.slice(0,3).join("\n- ")}
`;
      try{
        await navigator.clipboard.writeText(txt);
        $("#copyBtn").textContent = "Copi√© ‚úì";
        setTimeout(()=>$("#copyBtn").textContent="Copier le r√©sum√©", 1200);
      }catch(e){
        alert("Copie impossible sur cet appareil. (Astuce : utiliser Chrome)");
      }
    };

    $("#newBtn").onclick = resetAll;
  }

  // --------- Rendering ----------
  function render(){
    setSummary();

    // Header per step
    const titles = {
      1: ["√âtape 1 ‚Äî Profil fumeur", "Consommation + sensation recherch√©e. On vise un mat√©riel qui √©vite la frustration."],
      2: ["√âtape 2 ‚Äî Habitudes", "Contexte d‚Äôutilisation + exp√©rience. On s√©curise l‚Äôusage au quotidien."],
      3: ["√âtape 3 ‚Äî Priorit√©", "On finalise : simplicit√©, autonomie, discr√©tion ou vapeur."],
      4: ["R√©sultat ‚Äî Recommandation STOOM", "Synth√®se claire + points de vigilance. Le vendeur peut copier le r√©sum√©."]
    };
    $("#panelTitle").textContent = titles[state.step][0];
    $("#panelSub").textContent   = titles[state.step][1];

    setProgress();

    // Step content
    if(state.step === 1){
      mount(`
        <div class="q">Consommation <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"cigs", value:"low", icon:"‚ë†", title:"‚Äì 10 / jour", desc:"Profil l√©ger ‚Ä¢ objectif confort."})}
          ${cardOption({key:"cigs", value:"mid", icon:"‚ë°", title:"10‚Äì15 / jour", desc:"Profil mod√©r√© ‚Ä¢ besoin stable."})}
          ${cardOption({key:"cigs", value:"high", icon:"‚ë¢", title:"15‚Äì20 / jour", desc:"Profil soutenu ‚Ä¢ vigilance dosage."})}
          ${cardOption({key:"cigs", value:"veryhigh", icon:"‚ë£", title:"20+ / jour", desc:"Profil intense ‚Ä¢ priorit√© sati√©t√©."})}
        </div>

        <div style="height:14px"></div>

        <div class="q">Sensation recherch√©e <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"feel", value:"cig", icon:"‚üÇ", title:"Proche cigarette", desc:"Hit + tirage serr√© (MTL)."} )}
          ${cardOption({key:"feel", value:"balanced", icon:"‚âà", title:"√âquilibr√©", desc:"Polyvalent ‚Ä¢ bon compromis."} )}
          ${cardOption({key:"feel", value:"vapeur", icon:"‚òÅÔ∏é", title:"Plus de vapeur", desc:"RDL ‚Ä¢ vapeur ma√Ætris√©e."} )}
          <div style="opacity:.0;pointer-events:none"></div>
        </div>

        ${navButtons()}
      `);
      wireNav();
      $("#resultBox").style.display = "none";
    }

    if(state.step === 2){
      mount(`
        <div class="q">Niveau d‚Äôexp√©rience <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"level", value:"beginner", icon:"‚òÖ", title:"D√©butant", desc:"On privil√©gie simple & fiable."})}
          ${cardOption({key:"level", value:"intermediate", icon:"‚òÜ", title:"D√©j√† vapot√©", desc:"On optimise confort/usage."})}
          ${cardOption({key:"level", value:"advanced", icon:"‚ú¶", title:"Confirm√©", desc:"On peut affiner les r√©glages."})}
          <div style="opacity:.0;pointer-events:none"></div>
        </div>

        <div style="height:14px"></div>

        <div class="q">Contexte principal <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"context", value:"quick", icon:"‚ö°", title:"Pauses rapides", desc:"Besoin d‚Äôefficacit√© imm√©diate."})}
          ${cardOption({key:"context", value:"home", icon:"‚åÇ", title:"Maison", desc:"Confort + autonomie tranquille."})}
          ${cardOption({key:"context", value:"car", icon:"‚üü", title:"Voiture", desc:"Discr√©tion + stabilit√© airflow."})}
          ${cardOption({key:"context", value:"mixed", icon:"‚ü≤", title:"Partout", desc:"Polyvalence avant tout."})}
        </div>

        ${navButtons()}
      `);
      wireNav();
      $("#resultBox").style.display = "none";
    }

    if(state.step === 3){
      mount(`
        <div class="q">Votre priorit√© n¬∞1 <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"priority", value:"simple", icon:"‚úì", title:"Simple & fiable", desc:"Z√©ro prise de t√™te, efficace."})}
          ${cardOption({key:"priority", value:"autonomie", icon:"üîã", title:"Autonomie", desc:"Tenir la journ√©e sans stress."})}
          ${cardOption({key:"priority", value:"discret", icon:"‚óªÔ∏é", title:"Discret", desc:"Compact, discret, pratique."})}
          ${cardOption({key:"priority", value:"vapeur", icon:"‚òÅ", title:"Vapeur", desc:"Plus de densit√© (ma√Ætris√©e)."})}
        </div>

        ${navButtons()}
      `);
      wireNav();
      $("#resultBox").style.display = "none";
    }

    if(state.step === 4){
      mount(`
        <div class="q">Synth√®se pr√™te <small>copiable</small></div>
        <div style="color:var(--muted);font-size:13px;line-height:1.45">
          Le panneau de droite affiche la recommandation STOOM + les points de vigilance.  
          Vous pouvez <strong>copier le r√©sum√©</strong> pour le noter sur une fiche client, un SMS, ou WhatsApp.
        </div>
        ${navButtons()}
      `);
      wireNav();
      showResult();
    }

    // button states (disabled style)
    document.querySelectorAll("button[disabled]").forEach(b=>{
      b.style.opacity = .55;
      b.style.cursor = "not-allowed";
    });
  }

  function resetAll(){
    state.step = 1;
    state.cigs = null;
    state.feel = null;
    state.level = null;
    state.context = null;
    state.priority = null;
    $("#resultBox").style.display = "none";
    render();
  }

  $("#resetBtn").onclick = resetAll;

  // Init
  render();
</script>
</body>
</html>
