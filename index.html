<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>STOOM ‚Äî Assistant mat√©riel (tablette)</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.085);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.52);
      --brand:#3B82F6;
      --brand2:#60A5FA;
      --ok:#22C55E;
      --warn:#F59E0B;
      --bad:#EF4444;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r: 22px;
      --tap: 64px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 20% 10%, rgba(59,130,246,.35), transparent 55%),
        radial-gradient(900px 600px at 80% 20%, rgba(96,165,250,.22), transparent 55%),
        radial-gradient(900px 600px at 50% 100%, rgba(34,197,94,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .wrap{
      max-width: 1080px;
      margin: 0 auto;
      padding: 22px 18px 40px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .logo{
      width:44px; height:44px;
      border-radius:14px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.45), transparent 60%),
        linear-gradient(135deg, rgba(59,130,246,.95), rgba(96,165,250,.65));
      box-shadow: 0 10px 30px rgba(59,130,246,.22);
      border:1px solid rgba(255,255,255,.20);
      flex:0 0 auto;
    }
    .brand h1{
      font-size: 18px;
      line-height:1.15;
      margin:0;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand p{
      margin:2px 0 0;
      font-size: 12.5px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex:0 0 auto;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted);
      font-size: 12.5px;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: var(--ok);
      box-shadow:0 0 0 6px rgba(34,197,94,.12);
    }

    .btn{
      border:none;
      border-radius: 16px;
      min-height: 48px;
      padding: 12px 14px;
      font-weight: 700;
      letter-spacing:.2px;
      color: rgba(255,255,255,.94);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(96,165,250,.75));
      border-color: rgba(255,255,255,.20);
      box-shadow: 0 14px 40px rgba(59,130,246,.18);
    }
    .btn.ghost{
      background: rgba(255,255,255,.06);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 14px;
      align-items:start;
    }

    .panel{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .panelHead{
      padding: 16px 16px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
    }
    .panelHead .title{
      margin:0;
      font-size: 15px;
      letter-spacing:.2px;
    }
    .panelHead .sub{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
      max-width: 58ch;
    }

    /* Progress */
    .progressWrap{
      padding: 0 16px 14px;
    }
    .progress{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(59,130,246,.95), rgba(96,165,250,.65));
      border-right:1px solid rgba(255,255,255,.24);
      transition: width .25s ease;
    }
    .stepsRow{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted2);
      font-size: 12px;
    }
    .stepChip{
      padding: 7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    .stepChip.on{
      color: rgba(255,255,255,.90);
      border-color: rgba(59,130,246,.45);
      background: rgba(59,130,246,.12);
    }

    /* Questions */
    .content{
      padding: 14px 16px 16px;
    }

    .q{
      margin: 0 0 10px;
      font-size: 14px;
      color: rgba(255,255,255,.90);
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .q small{
      font-weight:600;
      color: var(--muted2);
    }

    .options{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }

    .opt{
      min-height: var(--tap);
      padding: 14px 14px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      gap:12px;
      transition: background .15s ease, border-color .15s ease, transform .08s ease;
      user-select:none;
    }
    .opt:active{ transform: translateY(1px) scale(.995); }
    .opt .icon{
      width:38px;height:38px;border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      display:grid;
      place-items:center;
      font-weight:900;
      color: rgba(255,255,255,.86);
      flex:0 0 auto;
    }
    .opt .txt{ min-width:0; }
    .opt .txt .t{
      font-weight:800;
      letter-spacing:.2px;
      font-size: 14px;
      margin:0 0 4px;
    }
    .opt .txt .d{
      margin:0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.25;
    }

    .opt.on{
      background: rgba(59,130,246,.12);
      border-color: rgba(59,130,246,.55);
      box-shadow: 0 10px 26px rgba(59,130,246,.12);
    }
    .opt.on .icon{
      background: linear-gradient(135deg, rgba(59,130,246,.95), rgba(96,165,250,.65));
      border-color: rgba(255,255,255,.20);
    }

    .navRow{
      margin-top: 14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }

    /* Side summary */
    .side{
      padding: 14px;
    }
    .summaryTitle{
      margin: 0 0 10px;
      font-size: 14px;
      color: rgba(255,255,255,.88);
    }
    .mini{
      display:grid;
      gap:10px;
      max-height: 360px;
      overflow:auto;
      padding-right:4px;
    }
    .mini::-webkit-scrollbar{ width:8px; }
    .mini::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.10); border-radius: 999px; }
    .miniCard{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 12px 12px;
    }
    .miniCard .k{
      color: var(--muted2);
      font-size: 12px;
      margin:0 0 6px;
    }
    .miniCard .v{
      margin:0;
      font-weight:800;
      font-size: 13.5px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .hint{
      margin-top: 12px;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }

    /* Result */
    .result{
      margin-top: 14px;
      padding: 14px 14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
    }
    .badges{ display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
    .b{
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight:800;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
    }
    .b.ok{ background: rgba(34,197,94,.10); border-color: rgba(34,197,94,.35); }
    .b.warn{ background: rgba(245,158,11,.12); border-color: rgba(245,158,11,.40); }
    .b.info{ background: rgba(59,130,246,.12); border-color: rgba(59,130,246,.40); }

    .kpis{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
      margin-top: 10px;
    }
    .kpi{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      padding: 12px;
    }
    .kpi .k{ margin:0 0 6px; color: var(--muted2); font-size: 12px; }
    .kpi .v{ margin:0; font-weight:900; font-size: 14px; }
    .kpi .s{ margin:6px 0 0; color: var(--muted); font-size: 12px; line-height:1.25; }

    .sectionTitle{
      margin: 14px 0 8px;
      font-weight:900;
      font-size: 12.5px;
      color: rgba(255,255,255,.86);
      letter-spacing:.25px;
      text-transform: uppercase;
    }

    .list{
      margin: 10px 0 0;
      padding: 0;
      list-style:none;
      display:grid;
      gap:8px;
    }
    .li{
      display:flex; gap:10px; align-items:flex-start;
      padding: 10px 10px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .li .ic{
      width:26px;height:26px;border-radius:10px;
      display:grid;place-items:center;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      flex:0 0 auto;
      font-weight:900;
      color: rgba(255,255,255,.86);
    }
    .li .tx{
      min-width:0;
      color: rgba(255,255,255,.86);
      font-size: 12.8px;
      line-height:1.25;
    }

    .tools{
      display:flex;
      gap:10px;
      margin-top: 12px;
    }
    .tools .btn{ flex:1; }

    /* Tablet friendliness */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .kpis{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div style="min-width:0">
          <h1>STOOM ‚Äî Assistant mat√©riel</h1>
          <p>Parcours vendeur ‚Ä¢ tablette tactile ‚Ä¢ recommandations + tips + budget</p>
        </div>
      </div>

      <div class="actions">
        <div class="pill"><span class="dot"></span>Pr√™t en boutique</div>
        <button class="btn ghost" id="resetBtn" type="button">R√©initialiser</button>
      </div>
    </div>

    <div class="grid">
      <!-- Main panel -->
      <section class="panel" aria-label="Parcours">
        <header class="panelHead">
          <div>
            <h2 class="title" id="panelTitle">√âtape 1 ‚Äî Profil fumeur</h2>
            <p class="sub" id="panelSub">
              On commence simple : consommation + sensation recherch√©e. Objectif : confort et stabilit√©.
            </p>
          </div>
          <div style="text-align:right;">
            <div style="font-weight:900;font-size:12px;color:var(--muted2);">Progression</div>
            <div style="font-weight:900;font-size:16px;" id="pct">0%</div>
          </div>
        </header>

        <div class="progressWrap">
          <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="bar" id="bar"></div>
          </div>
          <div class="stepsRow" id="chips">
            <span class="stepChip on">1 Profil</span>
            <span class="stepChip">2 Habitudes</span>
            <span class="stepChip">3 Usage</span>
            <span class="stepChip">4 Priorit√©</span>
            <span class="stepChip">R√©sultat</span>
          </div>
        </div>

        <div class="content" id="content"></div>
      </section>

      <!-- Side panel -->
      <aside class="panel" aria-label="R√©sum√©">
        <div class="side">
          <h3 class="summaryTitle">R√©sum√© client</h3>

          <div class="mini">
            <div class="miniCard">
              <p class="k">Consommation</p>
              <p class="v" id="sCigs">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Sensation recherch√©e</p>
              <p class="v" id="sFeel">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Habitudes</p>
              <p class="v" id="sHabits">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Style</p>
              <p class="v" id="sStyle">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Niveau</p>
              <p class="v" id="sLevel">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Contexte</p>
              <p class="v" id="sContext">‚Äî</p>
            </div>
            <div class="miniCard">
              <p class="k">Priorit√©</p>
              <p class="v" id="sPriority">‚Äî</p>
            </div>
          </div>

          <p class="hint">
            üí° Astuce vendeur : laisser le client choisir ‚Äúce qui compte le plus‚Äù, puis caler le mat√©riel + dosage sur son quotidien (habitudes).
          </p>

          <div class="result" id="resultBox" style="display:none;">
            <div class="badges" id="badges"></div>

            <div class="sectionTitle">Recommandations</div>
            <div class="kpis">
              <div class="kpi">
                <p class="k">Option A ‚Äî S√©curit√© sevrage</p>
                <p class="v" id="rA">‚Äî</p>
                <p class="s" id="rANote"></p>
              </div>
              <div class="kpi">
                <p class="k">Option B ‚Äî √âvolutive</p>
                <p class="v" id="rB">‚Äî</p>
                <p class="s" id="rBNote"></p>
              </div>
              <div class="kpi">
                <p class="k">Nicotine (rep√®re)</p>
                <p class="v" id="rNico">‚Äî</p>
                <p class="s" id="rNicoNote"></p>
              </div>
              <div class="kpi">
                <p class="k">Budget tabac estim√©</p>
                <p class="v" id="rBudget">‚Äî</p>
                <p class="s" id="rBudgetNote">Base : 12,50 ‚Ç¨ / paquet (20 cig.)</p>
              </div>
            </div>

            <div class="sectionTitle">Tips personnalis√©s</div>
            <ul class="list" id="tips"></ul>

            <div class="sectionTitle">√Ä √©viter</div>
            <ul class="list" id="avoid"></ul>

            <div class="tools">
              <button class="btn ghost" id="copyBtn" type="button">Copier le r√©sum√©</button>
              <button class="btn primary" id="newBtn" type="button">Nouveau client</button>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
  // ---------------- STATE ----------------
  const state = {
    step: 1,
    cigs: null,     // low, mid, high, veryhigh
    feel: null,     // cig, balanced, vapeur
    habits: [],     // multi: coffee, aftermeal, car, stress, party, morning, breaks, tv
    style: null,    // ritual, chain, fewpuffs, finish
    level: null,    // beginner, intermediate, advanced
    context: null,  // quick, home, car, mixed
    priority: null  // simple, autonomie, discret, vapeur, hit, gout, calme
  };

  // ---------------- LABELS ----------------
  const L = {
    cigs: {
      low: "‚Äì 10 cig/j",
      mid: "10‚Äì15 cig/j",
      high: "15‚Äì20 cig/j",
      veryhigh: "20+ cig/j"
    },
    feel: {
      cig: "Proche cigarette (hit / tirage serr√©)",
      balanced: "√âquilibr√© (confort + polyvalent)",
      vapeur: "Plus de vapeur (ma√Ætris√©e)"
    },
    habits: {
      coffee: "Caf√©",
      aftermeal: "Apr√®s repas",
      car: "Voiture",
      stress: "Stress",
      breaks: "Pauses",
      morning: "R√©veil",
      party: "Soir√©e",
      tv: "TV / gaming"
    },
    style: {
      ritual: "Une par une",
      chain: "En rafale",
      fewpuffs: "2‚Äì3 bouff√©es",
      finish: "Je finis toujours"
    },
    level: {
      beginner: "D√©butant",
      intermediate: "D√©j√† vapot√©",
      advanced: "Confirm√©"
    },
    context: {
      quick: "Pauses rapides (travail)",
      home: "Plut√¥t maison",
      car: "Beaucoup voiture",
      mixed: "Un peu partout"
    }
  };

  // ---------------- HELPERS ----------------
  const $ = (sel) => document.querySelector(sel);

  function fmt2(n){
    return (Math.round((n + Number.EPSILON) * 100) / 100).toFixed(2);
  }

  function avgCigsPerDay(){
    // mapping "cr√©dible" (moyenne) bas√© sur les cat√©gories
    if(state.cigs === "low") return 8;
    if(state.cigs === "mid") return 12.5;
    if(state.cigs === "high") return 17.5;
    if(state.cigs === "veryhigh") return 25;
    return null;
  }

  function calcBudget(){
    const cpd = avgCigsPerDay();
    if(!cpd) return null;
    const packPrice = 12.5;
    const perDay = (cpd / 20) * packPrice;
    const perMonth = perDay * 30;
    const perYear = perDay * 365;
    return { cpd, perDay, perMonth, perYear, packPrice };
  }

  function setSummary(){
    $("#sCigs").textContent = state.cigs ? L.cigs[state.cigs] : "‚Äî";
    $("#sFeel").textContent = state.feel ? L.feel[state.feel] : "‚Äî";
    $("#sHabits").textContent = state.habits.length ? state.habits.map(h => L.habits[h]).join(" ‚Ä¢ ") : "‚Äî";
    $("#sStyle").textContent = state.style ? L.style[state.style] : "‚Äî";
    $("#sLevel").textContent = state.level ? L.level[state.level] : "‚Äî";
    $("#sContext").textContent = state.context ? L.context[state.context] : "‚Äî";
    $("#sPriority").textContent = state.priority ? state.priority : "‚Äî";
  }

  function setProgress(){
    const totalSteps = 5;
    const pct = Math.round(((state.step-1) / (totalSteps-1)) * 100);
    $("#pct").textContent = pct + "%";
    $("#bar").style.width = pct + "%";
    $(".progress").setAttribute("aria-valuenow", String(pct));

    const chips = [...$("#chips").children];
    chips.forEach((c, i) => c.classList.toggle("on", i <= state.step-1));
  }

  function isOn(key, value){
    if(Array.isArray(state[key])) return state[key].includes(value);
    return state[key] === value;
  }

  function cardOption({key, value, icon, title, desc}){
    const on = isOn(key, value) ? " on" : "";
    return `
      <div class="opt${on}" role="button" tabindex="0" data-key="${key}" data-value="${value}">
        <div class="icon">${icon}</div>
        <div class="txt">
          <p class="t">${title}</p>
          <p class="d">${desc || ""}</p>
        </div>
      </div>
    `;
  }

  function mount(html){
    $("#content").innerHTML = html;

    $("#content").querySelectorAll(".opt").forEach(el => {
      const handler = () => {
        const key = el.dataset.key;
        const val = el.dataset.value;

        if(key === "habits") return toggleHabit(val);
        if(key === "style") return pickStyle(val);
        return pick(key, val);
      };

      el.addEventListener("click", handler);
      el.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          handler();
        }
      });
    });
  }

  function pick(key, value){
    state[key] = value;

    // priorit√© label plus "humain" (sans changer l‚Äôesth√©tique)
    if(key === "priority"){
      const map = {
        simple: "Simple & fiable",
        autonomie: "Autonomie",
        discret: "Discret",
        vapeur: "Vapeur",
        hit: "Hit",
        gout: "Go√ªt",
        calme: "Me calmer"
      };
      state.priority = map[value] || value;
    }

    render();
    autoAdvance();
  }

  function toggleHabit(value){
    const i = state.habits.indexOf(value);
    if(i >= 0) state.habits.splice(i, 1);
    else state.habits.push(value);

    // garde l'outil rapide : max 4 habitudes
    if(state.habits.length > 4){
      state.habits.shift();
    }

    render();
    autoAdvance();
  }

  function pickStyle(value){
    state.style = value;
    render();
    autoAdvance();
  }

  function stepComplete(n){
    if(n === 1) return !!(state.cigs && state.feel);
    if(n === 2) return !!(state.habits.length >= 1 && state.style);
    if(n === 3) return !!(state.level && state.context);
    if(n === 4) return !!(state.priority);
    return true;
  }

  function autoAdvance(){
    if(state.step === 1 && stepComplete(1)){ state.step = 2; render(); return; }
    if(state.step === 2 && stepComplete(2)){ state.step = 3; render(); return; }
    if(state.step === 3 && stepComplete(3)){ state.step = 4; render(); return; }
    if(state.step === 4 && stepComplete(4)){ state.step = 5; render(); return; }
  }

  function navButtons(){
    const backDisabled = state.step === 1;
    const nextDisabled = (state.step === 1 && !stepComplete(1)) ||
                         (state.step === 2 && !stepComplete(2)) ||
                         (state.step === 3 && !stepComplete(3)) ||
                         (state.step === 4 && !stepComplete(4));
    const nextLabel = state.step < 5 ? "Continuer" : "Revoir";
    return `
      <div class="navRow">
        <button class="btn ghost" type="button" ${backDisabled ? "disabled" : ""} id="backBtn">Retour</button>
        <button class="btn primary" type="button" ${nextDisabled ? "disabled" : ""} id="nextBtn">${nextLabel}</button>
      </div>
    `;
  }

  function wireNav(){
    const back = $("#backBtn");
    const next = $("#nextBtn");
    if(back) back.onclick = () => { state.step = Math.max(1, state.step-1); render(); };
    if(next) next.onclick = () => {
      if(state.step < 5){
        state.step += 1;
        render();
      }else{
        state.step = 1;
        render();
      }
    };
  }

  // ---------------- TIPS ENGINE ----------------
  function buildTips(){
    const tips = [];
    const h = new Set(state.habits);

    if(h.has("coffee")){
      tips.push("Commencer √† vapoter 1‚Äì2 minutes avant le caf√© : sati√©t√© plus rapide, moins de frustration.");
    }
    if(h.has("aftermeal")){
      tips.push("Apr√®s repas : 2‚Äì3 minutes de vape suffisent souvent. Rester sur le confort, pas la grosse vapeur.");
    }
    if(h.has("stress")){
      tips.push("Stress : rapprocher les bouff√©es quelques minutes. Si besoin, ajuster la nicotine plut√¥t que la puissance.");
    }
    if(h.has("car")){
      tips.push("Voiture : mat√©riel discret + tirage serr√© + airflow stable (moins de projections, plus pratique).");
    }
    if(h.has("breaks")){
      tips.push("Pauses courtes : efficacit√© imm√©diate = tirage serr√© + dosage confortable + autonomie suffisante.");
    }
    if(h.has("morning")){
      tips.push("R√©veil : √©viter le sous-dosage. Mieux vaut un dosage confortable qu‚Äôun mat√©riel plus puissant.");
    }
    if(h.has("party")){
      tips.push("Soir√©e : rester sur un set-up simple et stable. √âviter de bricoler les r√©glages.");
    }
    if(h.has("tv")){
      tips.push("TV/gaming : attention √† la surconsommation. Boire de l‚Äôeau et garder un dosage stable.");
    }

    // style
    if(state.style === "chain"){
      tips.push("Vous avez tendance √† encha√Æner : √©viter mat√©riel trop puissant + nicotine √©lev√©e (irritations).");
    }
    if(state.style === "fewpuffs"){
      tips.push("2‚Äì3 bouff√©es : privil√©gier un kit simple, r√©actif, toujours pr√™t (sans r√©glages).");
    }
    if(state.style === "finish"){
      tips.push("‚ÄúJe finis toujours‚Äù : attention au sous-dosage (sinon on tire trop longtemps).");
    }

    // priorit√©
    if(state.priority === "Hit"){
      tips.push("Hit : on r√®gle le confort via tirage + dosage, pas en montant la puissance.");
    }
    if(state.priority === "Go√ªt"){
      tips.push("Go√ªt : puissance mod√©r√©e et mat√©riel stable = saveurs plus propres.");
    }
    if(state.priority === "Autonomie"){
      tips.push("Autonomie : privil√©gier une batterie/format qui tient la journ√©e pour √©viter la panne (frustration).");
    }

    // dedupe + limit
    return [...new Set(tips)].slice(0, 6);
  }

  // ---------------- RECOMMENDATION ENGINE ----------------
  function recommend(){
    // Base A (s√©curit√©) + B (√©volutive)
    let A = {
      draw: "Serr√© (MTL)",
      power: "8‚Äì18W ‚Ä¢ 0.8‚Äì1.4Œ©",
      note: "Simple, stable, efficace pour d√©marrer."
    };
    let B = {
      draw: "MTL confortable / RDL l√©ger",
      power: "12‚Äì30W ‚Ä¢ 0.4‚Äì1.0Œ©",
      note: "√âvolutif si le client veut plus de polyvalence."
    };

    let nico = "3‚Äì6 mg/ml";
    let nicoNote = "Objectif : confort. Si envies persistantes ‚Üí ajuster la nicotine plut√¥t que la puissance.";

    const badges = [];
    const avoid = [];

    // consommation
    if(state.cigs === "low"){
      nico = "3‚Äì6 mg/ml";
      badges.push({t:"Profil l√©ger", c:"info"});
    }
    if(state.cigs === "mid"){
      nico = "6‚Äì12 mg/ml";
      badges.push({t:"Profil mod√©r√©", c:"info"});
      avoid.push("Partir trop bas en nicotine (envies persistantes).");
    }
    if(state.cigs === "high"){
      nico = "10‚Äì12 mg/ml (ou 10 mg sels selon confort)";
      badges.push({t:"Profil soutenu", c:"warn"});
      avoid.push("Mat√©riel trop puissant avec nicotine √©lev√©e (hit trop fort / irritation).");
      A.draw = "Serr√© (MTL) / restrictif";
      A.power = "8‚Äì16W ‚Ä¢ 1.0‚Äì1.4Œ©";
      A.note = "Priorit√© sati√©t√© + hit ma√Ætris√©.";
    }
    if(state.cigs === "veryhigh"){
      nico = "12‚Äì20 mg/ml (sels possibles)";
      badges.push({t:"Profil intense", c:"warn"});
      A.draw = "Serr√© (MTL) / tr√®s restrictif";
      A.power = "8‚Äì15W ‚Ä¢ 1.0‚Äì1.4Œ©";
      A.note = "Sati√©t√© rapide, confort, anti-rechute.";
      B.draw = "RDL l√©ger (si d√©j√† vapoteur)";
      B.power = "15‚Äì28W ‚Ä¢ 0.4‚Äì0.8Œ©";
      B.note = "Uniquement si dosage adapt√© + bon accompagnement.";
      avoid.push("Inhalation directe (DL) au d√©marrage.");
      avoid.push("Baisser trop vite la nicotine.");
    }

    // sensation recherch√©e
    if(state.feel === "cig"){
      badges.push({t:"Priorit√© sevrage", c:"ok"});
      A.draw = "Serr√© (MTL)";
      A.note = "Rep√®re proche cigarette : tirage serr√© + hit.";
      B.draw = "MTL confortable (un peu plus ouvert)";
      B.note = "√âvolutif sans perdre la stabilit√©.";
    }
    if(state.feel === "balanced"){
      badges.push({t:"Polyvalent", c:"info"});
      B.draw = "MTL confortable / RDL l√©ger";
      B.power = "12‚Äì25W ‚Ä¢ 0.6‚Äì1.0Œ©";
      B.note = "Tr√®s bon compromis confort/vapeur.";
    }
    if(state.feel === "vapeur"){
      badges.push({t:"Vapeur ma√Ætris√©e", c:"info"});
      B.draw = "RDL";
      B.power = "18‚Äì35W ‚Ä¢ 0.3‚Äì0.8Œ©";
      B.note = "Plus de vapeur, mais on garde le confort.";
      avoid.push("Rester haut en nicotine avec un tirage trop a√©rien.");
    }

    // experience
    if(state.level === "beginner"){
      badges.push({t:"D√©butant", c:"ok"});
      avoid.push("Trop de r√©glages / mat√©riel complexe au d√©part.");
      B.note = "√âvolutif mais toujours simple (pas une usine √† gaz).";
    }
    if(state.level === "advanced"){
      badges.push({t:"Confirm√©", c:"info"});
      if(state.feel === "vapeur"){
        B.power = "25‚Äì45W ‚Ä¢ 0.2‚Äì0.6Œ©";
        B.note = "Possible si le dosage nicotine est adapt√© et le client sait g√©rer.";
      }
    }

    // contexte
    if(state.context === "quick"){
      badges.push({t:"Pauses rapides", c:"info"});
      avoid.push("Autonomie trop faible (panne ‚Üí frustration).");
      A.note += " Efficace rapidement en pause.";
    }
    if(state.context === "car"){
      badges.push({t:"Voiture", c:"info"});
      avoid.push("Airflow trop ouvert (projection / bruit).");
      A.note += " Discret et stable en voiture.";
    }
    if(state.context === "mixed"){
      badges.push({t:"Quotidien", c:"info"});
    }

    // priorit√© (affinage)
    if(state.priority === "Simple & fiable"){
      badges.push({t:"Simple", c:"ok"});
      A.note = "Le plus simple et le plus robuste pour d√©marrer.";
    }
    if(state.priority === "Autonomie"){
      badges.push({t:"Autonomie", c:"info"});
      A.note += " Pr√©voir une autonomie journ√©e.";
      B.note += " Choisir un format qui tient la journ√©e.";
    }
    if(state.priority === "Discret"){
      badges.push({t:"Discret", c:"info"});
      A.note += " Format compact recommand√©.";
      avoid.push("Gros setup si le client veut du pocket-friendly.");
    }
    if(state.priority === "Vapeur"){
      badges.push({t:"Vapeur", c:"info"});
      B.note += " Rester progressif pour √©viter l‚Äôabandon.";
      avoid.push("Chercher la vapeur avant la stabilit√©.");
    }
    if(state.priority === "Hit"){
      badges.push({t:"Hit", c:"info"});
      avoid.push("Compenser un manque de nicotine par trop de puissance.");
    }
    if(state.priority === "Go√ªt"){
      badges.push({t:"Saveurs", c:"info"});
    }
    if(state.priority === "Me calmer"){
      badges.push({t:"Confort", c:"ok"});
      nicoNote = "Si √ßa ne calme pas : d‚Äôabord rapprocher les bouff√©es, sinon ajuster la nicotine (pas la puissance).";
    }

    const uniqAvoid = [...new Set(avoid)];
    if(uniqAvoid.length === 0){
      uniqAvoid.push("Changer trop de param√®tres en m√™me temps : y aller progressivement.");
    }

    return { A, B, nico, nicoNote, badges, uniqAvoid };
  }

  function showResult(){
    const rec = recommend();
    const tips = buildTips();
    const bud = calcBudget();

    $("#resultBox").style.display = "block";

    // badges
    const b = rec.badges.slice(0,7).map(x => `<span class="b ${x.c}">${x.t}</span>`).join("");
    $("#badges").innerHTML = b || `<span class="b info">Recommandation</span>`;

    // Options
    $("#rA").textContent = `${rec.A.draw} ‚Ä¢ ${rec.A.power}`;
    $("#rANote").textContent = rec.A.note;

    $("#rB").textContent = `${rec.B.draw} ‚Ä¢ ${rec.B.power}`;
    $("#rBNote").textContent = rec.B.note;

    $("#rNico").textContent = rec.nico;
    $("#rNicoNote").textContent = rec.nicoNote;

    // Budget
    if(bud){
      $("#rBudget").textContent = `‚âà ${fmt2(bud.perMonth)} ‚Ç¨ / mois ‚Ä¢ ‚âà ${fmt2(bud.perYear)} ‚Ç¨ / an`;
      $("#rBudgetNote").textContent = `‚âà ${fmt2(bud.perDay)} ‚Ç¨ / jour (sur ${bud.cpd} cig/j estim√©es) ‚Ä¢ Base : 12,50 ‚Ç¨ / paquet`;
    }else{
      $("#rBudget").textContent = "‚Äî";
      $("#rBudgetNote").textContent = "Base : 12,50 ‚Ç¨ / paquet (20 cig.)";
    }

    // tips
    $("#tips").innerHTML = (tips.length ? tips : ["Objectif : un mat√©riel confortable + dosage adapt√©."])
      .map(t => `<li class="li"><div class="ic">üí°</div><div class="tx">${t}</div></li>`)
      .join("");

    // avoid
    $("#avoid").innerHTML = rec.uniqAvoid
      .slice(0,5)
      .map(t => `<li class="li"><div class="ic">!</div><div class="tx">${t}</div></li>`)
      .join("");

    // Copy summary
    $("#copyBtn").onclick = async () => {
      const budTxt = bud
        ? `Budget tabac (estim.) : ${fmt2(bud.perDay)} ‚Ç¨/jour ‚Ä¢ ${fmt2(bud.perMonth)} ‚Ç¨/mois ‚Ä¢ ${fmt2(bud.perYear)} ‚Ç¨/an (12,50‚Ç¨/paquet)`
        : `Budget tabac (estim.) : ‚Äî (12,50‚Ç¨/paquet)`;

      const txt =
`STOOM ‚Äî R√©sum√© orientation mat√©riel
- Consommation : ${state.cigs ? L.cigs[state.cigs] : "‚Äî"}
- Sensation : ${state.feel ? L.feel[state.feel] : "‚Äî"}
- Habitudes : ${state.habits.length ? state.habits.map(h => L.habits[h]).join(", ") : "‚Äî"}
- Style : ${state.style ? L.style[state.style] : "‚Äî"}
- Niveau : ${state.level ? L.level[state.level] : "‚Äî"}
- Contexte : ${state.context ? L.context[state.context] : "‚Äî"}
- Priorit√© : ${state.priority || "‚Äî"}

Recommandations :
Option A (S√©curit√©) : ${rec.A.draw} ‚Ä¢ ${rec.A.power} ‚Äî ${rec.A.note}
Option B (√âvolutive) : ${rec.B.draw} ‚Ä¢ ${rec.B.power} ‚Äî ${rec.B.note}

Nicotine (rep√®re) : ${rec.nico}
Note : ${rec.nicoNote}

${budTxt}

Tips :
- ${buildTips().slice(0,5).join("\n- ")}

√Ä √©viter :
- ${rec.uniqAvoid.slice(0,3).join("\n- ")}
`;
      try{
        await navigator.clipboard.writeText(txt);
        $("#copyBtn").textContent = "Copi√© ‚úì";
        setTimeout(()=>$("#copyBtn").textContent="Copier le r√©sum√©", 1200);
      }catch(e){
        alert("Copie impossible sur cet appareil. (Astuce : utiliser Chrome)");
      }
    };

    $("#newBtn").onclick = resetAll;
  }

  // ---------------- RENDER ----------------
  function render(){
    setSummary();

    const titles = {
      1: ["√âtape 1 ‚Äî Profil fumeur", "Consommation + sensation recherch√©e. On pose une base solide et confortable."],
      2: ["√âtape 2 ‚Äî Habitudes", "Moments cl√©s + style de consommation. √áa g√©n√®re les tips personnalis√©s."],
      3: ["√âtape 3 ‚Äî Usage", "Exp√©rience + contexte. On s√©curise le quotidien : simplicit√©, autonomie, stabilit√©."],
      4: ["√âtape 4 ‚Äî Priorit√©", "Ce qui compte le plus : simple, autonomie, discret, vapeur, hit, go√ªt‚Ä¶"],
      5: ["R√©sultat ‚Äî Outil ultime STOOM", "Double recommandation + nicotine + budget tabac + tips + points √† √©viter."]
    };
    $("#panelTitle").textContent = titles[state.step][0];
    $("#panelSub").textContent   = titles[state.step][1];

    setProgress();

    if(state.step === 1){
      mount(`
        <div class="q">Consommation <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"cigs", value:"low", icon:"‚ë†", title:"‚Äì 10 / jour", desc:"Estimation budget sur ~8 cig/j."})}
          ${cardOption({key:"cigs", value:"mid", icon:"‚ë°", title:"10‚Äì15 / jour", desc:"Estimation budget sur ~12,5 cig/j."})}
          ${cardOption({key:"cigs", value:"high", icon:"‚ë¢", title:"15‚Äì20 / jour", desc:"Estimation budget sur ~17,5 cig/j."})}
          ${cardOption({key:"cigs", value:"veryhigh", icon:"‚ë£", title:"20+ / jour", desc:"Estimation budget sur ~25 cig/j."})}
        </div>

        <div style="height:14px"></div>

        <div class="q">Sensation recherch√©e <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"feel", value:"cig", icon:"‚üÇ", title:"Proche cigarette", desc:"Tirage serr√© + hit, rep√®re facile."} )}
          ${cardOption({key:"feel", value:"balanced", icon:"‚âà", title:"√âquilibr√©", desc:"Polyvalent, confortable au quotidien."} )}
          ${cardOption({key:"feel", value:"vapeur", icon:"‚òÅÔ∏é", title:"Plus de vapeur", desc:"Progressif, sans sacrifier le confort."} )}
          <div style="opacity:.0;pointer-events:none"></div>
        </div>

        ${navButtons()}
      `);
      wireNav();
      $("#resultBox").style.display = "none";
    }

    if(state.step === 2){
      mount(`
        <div class="q">Moments cl√©s <small>choisir 1 √† 4</small></div>
        <div class="options">
          ${cardOption({key:"habits", value:"coffee", icon:"‚òï", title:"Caf√©", desc:"Tips d√©di√©s caf√©/cigarette."})}
          ${cardOption({key:"habits", value:"aftermeal", icon:"üçΩÔ∏è", title:"Apr√®s repas", desc:"Tips d√©di√©s apr√®s repas."})}
          ${cardOption({key:"habits", value:"stress", icon:"üò∞", title:"Stress", desc:"Tips d√©di√©s stress/tension."})}
          ${cardOption({key:"habits", value:"car", icon:"üöó", title:"Voiture", desc:"Tips d√©di√©s voiture."})}
          ${cardOption({key:"habits", value:"breaks", icon:"‚è±Ô∏è", title:"Pauses courtes", desc:"Tips d√©di√©s pauses travail."})}
          ${cardOption({key:"habits", value:"morning", icon:"üåÖ", title:"Au r√©veil", desc:"Tips d√©di√©s matin."})}
          ${cardOption({key:"habits", value:"party", icon:"üç∫", title:"Soir√©e", desc:"Tips d√©di√©s soir√©e."})}
          ${cardOption({key:"habits", value:"tv", icon:"üì∫", title:"TV / gaming", desc:"Tips d√©di√©s surconsommation."})}
        </div>

        <div style="height:14px"></div>

        <div class="q">Style de consommation <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"style", value:"ritual", icon:"üö¨", title:"Une par une", desc:"Rituel : rep√®re proche cigarette."})}
          ${cardOption({key:"style", value:"chain", icon:"üîÅ", title:"En rafale", desc:"Encha√Ænement : vigilance irritation."})}
          ${cardOption({key:"style", value:"fewpuffs", icon:"üëÑ", title:"2‚Äì3 bouff√©es", desc:"Besoin d‚Äôun mat√©riel ‚Äútoujours pr√™t‚Äù."})}
          ${cardOption({key:"style", value:"finish", icon:"üî•", title:"Je finis toujours", desc:"Vigilance sous-dosage."})}
        </div>

        ${navButtons()}
      `);
      wireNav();
      $("#resultBox").style.display = "none";
    }

    if(state.step === 3){
      mount(`
        <div class="q">Niveau d‚Äôexp√©rience <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"level", value:"beginner", icon:"‚òÖ", title:"D√©butant", desc:"Le plus simple possible."})}
          ${cardOption({key:"level", value:"intermediate", icon:"‚òÜ", title:"D√©j√† vapot√©", desc:"On optimise confort/usage."})}
          ${cardOption({key:"level", value:"advanced", icon:"‚ú¶", title:"Confirm√©", desc:"On peut affiner davantage."})}
          <div style="opacity:.0;pointer-events:none"></div>
        </div>

        <div style="height:14px"></div>

        <div class="q">Contexte principal <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"context", value:"quick", icon:"‚ö°", title:"Pauses rapides", desc:"Efficacit√© imm√©diate."})}
          ${cardOption({key:"context", value:"home", icon:"‚åÇ", title:"Maison", desc:"Confort + autonomie tranquille."})}
          ${cardOption({key:"context", value:"car", icon:"‚üü", title:"Voiture", desc:"Discr√©tion + stabilit√© airflow."})}
          ${cardOption({key:"context", value:"mixed", icon:"‚ü≤", title:"Partout", desc:"Polyvalence avant tout."})}
        </div>

        ${navButtons()}
      `);
      wireNav();
      $("#resultBox").style.display = "none";
    }

    if(state.step === 4){
      mount(`
        <div class="q">Votre priorit√© n¬∞1 <small>obligatoire</small></div>
        <div class="options">
          ${cardOption({key:"priority", value:"simple", icon:"‚úì", title:"Simple & fiable", desc:"Z√©ro prise de t√™te."})}
          ${cardOption({key:"priority", value:"autonomie", icon:"üîã", title:"Autonomie", desc:"Tenir la journ√©e."})}
          ${cardOption({key:"priority", value:"discret", icon:"‚óªÔ∏é", title:"Discret", desc:"Compact, pratique."})}
          ${cardOption({key:"priority", value:"vapeur", icon:"‚òÅ", title:"Vapeur", desc:"Plus de densit√© (progressif)."})}
          ${cardOption({key:"priority", value:"hit", icon:"‚ö°", title:"Hit", desc:"Sensation en gorge."})}
          ${cardOption({key:"priority", value:"gout", icon:"üëÉ", title:"Go√ªt", desc:"Saveurs propres."})}
          ${cardOption({key:"priority", value:"calme", icon:"üòå", title:"Me calmer", desc:"Confort & stabilit√©."})}
          <div style="opacity:.0;pointer-events:none"></div>
        </div>

        ${navButtons()}
      `);
      wireNav();
      $("#resultBox").style.display = "none";
    }

    if(state.step === 5){
      mount(`
        <div class="q">Synth√®se pr√™te <small>copiable</small></div>
        <div style="color:var(--muted);font-size:13px;line-height:1.45">
          Le panneau de droite affiche la recommandation STOOM + budget tabac + tips personnalis√©s.  
          Vous pouvez <strong>copier le r√©sum√©</strong> pour le noter, l‚Äôenvoyer, ou le garder en suivi.
        </div>
        ${navButtons()}
      `);
      wireNav();
      showResult();
    }

    // disabled style
    document.querySelectorAll("button[disabled]").forEach(b=>{
      b.style.opacity = .55;
      b.style.cursor = "not-allowed";
    });
  }

  function resetAll(){
    state.step = 1;
    state.cigs = null;
    state.feel = null;
    state.habits = [];
    state.style = null;
    state.level = null;
    state.context = null;
    state.priority = null;
    $("#resultBox").style.display = "none";
    render();
  }

  $("#resetBtn").onclick = resetAll;

  // init
  render();
</script>
</body>
</html>
